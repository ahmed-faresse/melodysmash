<!doctype html>
<html> 
    <head>
        <meta charset="UTF-8" />
        <title>Melody Smash</title>
         <script src="phaser/build/phaser.js"></script>
        <script src="phaser/build/phaser.min.js"></script>
    </head>
    <body>

    <script type="text/javascript">

    window.onload = function() {

        var game = new Phaser.Game(800, 600, Phaser.CANVAS, '', { preload: preload, create: create, update: update, render: render });
        var map;
        var clicked;
        var savei = -1;
        var savej = -1;
        var timer = 0;
        var width = 20;
        var height = 25;
        var col = 20;
        var line = 20;
        var texture_group;

        function preload () {
            this.game.stage.scale.pageAlignHorizontally = true;
            this.game.stage.scale.pageAlignVertically = true;
            this.game.stage.scale.refresh();
            game.load.image('note', 'assets/note.png');
            game.load.image('notered', 'assets/notered.png');
        }

        function create () {
            
            clicked = 0;

            texture_group = game.add.group();
            texture_group.create(0, 0, 'note');
            texture_group.create(0, 0, 'notered');
            texture_group.setAll('scale.x', 0.1);
            texture_group.setAll('scale.y', 0.1);
            texture_group.setAll('visible', false);
            map = new Array(line);
            for (i = 0; i < line; i++)
            {
                map[i] = new Array(col);
                for (j = 0; j < col; j++)
                {
                    sprite = texture_group.getRandom();
                    console.log(sprite);
                    map[i][j] = game.add.sprite(i * width, j * height, sprite.key);
                    map[i][j].scale.setTo(0.1, 0.1);
                    map[i][j].inputEnabled = true;
                }
            }
            game.input.onDown.add(detect, this);
        }

        function detect(){
            var i = parseInt(game.input.x / 20);
            var j = parseInt(game.input.y / 25);
            if (clicked == 0)
            {
                savei = i;
                savej = j;
                map[i][j].alpha = 0.1;
                clicked = 1;
            }
            else if (clicked == 1)
            {
                map[savei][savej].alpha = 1;
                clicked = 0;
                savei = i;
                savej = j;
            }
        }

        function update(){

        }

        function render(){
            game.debug.renderInputInfo(410, 32);
            var i = parseInt(game.input.x / 20);
            var j = parseInt(game.input.y / 25);
            if (i > 0 && i < col && j > 0 && j < line)
            {
                game.debug.renderText("casex", 410, 132);
                game.debug.renderText(i, 490, 132);
                game.debug.renderText("casey", 410, 150);
                game.debug.renderText(i, 490, 150);
                game.debug.renderText("sprite", 410, 168);
                game.debug.renderText(map[i][j].key, 490, 168);
            }
        }
    };


    </script>

    </body>
</html>